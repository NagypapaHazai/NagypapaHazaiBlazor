@page "/events"
@using Microsoft.EntityFrameworkCore
@using NagypapaHazaiBlazor.MODELS
@inject NagypapaContext DbContext

<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-amber-900 flex items-center gap-3">
            <i class="fas fa-calendar-alt text-amber-600"></i> Események
        </h1>
    </div>

    @if (events == null)
    {
        <div class="flex justify-center items-center h-64">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"></div>
        </div>
    }
    else if (!events.Any())
    {
        <div class="text-center py-12 bg-amber-50 rounded-xl border border-amber-100">
            <i class="far fa-calendar-times text-4xl text-amber-300 mb-3"></i>
            <p class="text-amber-800 text-lg">Jelenleg nincsenek tervezett események.</p>
        </div>
    }
    else
    {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            @foreach (NagypapaHazaiBlazor.MODELS.Event eventItem in events)
            {
                <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 group border border-gray-100">

                    <!-- Kép vagy ikon rész -->
                    <div class="relative h-48 bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center overflow-hidden">

                        <div class="text-white opacity-90 transform group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-glass-cheers text-6xl"></i>
                        </div>

                        <!-- Dátum "badge" -->
                        <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm rounded-lg shadow-sm p-2 text-center min-w-[60px]">
                            <!-- JAVÍTVA: Null check (.Value használata) -->
                            <div class="text-xl font-bold text-blue-600 leading-none">
                                @(eventItem.StartDate.HasValue? eventItem.StartDate.Value.Day : "?")
                            </div>
                            <div class="text-[10px] font-bold uppercase text-gray-500 mt-1">
                                @(eventItem.StartDate.HasValue? eventItem.StartDate.Value.ToString("MMM") : "")
                            </div>
                        </div>
                    </div>

                    <!-- Tartalom rész -->
                    <div class="p-6">
                        <div class="mb-4">
                            <h3 class="text-xl font-bold text-gray-800 mb-2 group-hover:text-blue-600 transition-colors line-clamp-1">
                                @eventItem.Title
                            </h3>
                            <p class="text-gray-600 text-sm line-clamp-2 min-h-[40px]">
                                @eventItem.Description
                            </p>
                        </div>

                        <!-- Adatok alsó sáv -->
                        <div class="pt-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-500">
                            <div class="flex items-center gap-2" title="Időtartam">
                                <i class="far fa-clock text-blue-400"></i>
                                <!-- JAVÍTVA: Biztonságos kivonás -->
                                <span>
                                    @if (eventItem.StartDate.HasValue && eventItem.EndDate.HasValue)
                                    {
                                        @((eventItem.EndDate.Value - eventItem.StartDate.Value).Days + 1)
                                    }
                                    else
                                    {
                                        @("?")
                                    }
                                    nap
                                </span>
                            </div>

                            <div class="flex items-center gap-2" title="Férőhely">
                                <i class="fas fa-users text-blue-400"></i>
                                <!-- JAVÍTVA: MaxParticipants is nullable -->
                                <span>Max: @(eventItem.MaxParticipants ?? 0) fő</span>
                            </div>
                        </div>

                        <!-- Gomb -->
                        <div class="mt-4 pt-2">
                            <a href="/events/details/@eventItem.Id" class="block w-full text-center py-2 px-4 bg-blue-50 hover:bg-blue-100 text-blue-600 font-semibold rounded-lg transition-colors duration-200">
                                Részletek <i class="fas fa-arrow-right ml-1 text-xs"></i>
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    private List<NagypapaHazaiBlazor.MODELS.Event>? events;

    protected override async Task OnInitializedAsync()
    {
        events = await DbContext.Events
            .OrderBy(e => e.StartDate)
            .ToListAsync();
    }
}
